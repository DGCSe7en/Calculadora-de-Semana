<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de tiempo</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; margin: 0; transition: background-color 0.3s, color 0.3s;}
    body.modo-oscuro { background-color: #2e2e2e; color: #e0e0e0;}
    body.modo-claro { background-color: #f0f0f0; color: #1a1a1a;}
    .modo-claro .texto-azul { color: #0D47A1; }
    .modo-oscuro .texto-azul { color: #90D5FF; }
    .modo-claro .reloj { color: #0D47A1; }
    .modo-oscuro .reloj { color: #90D5FF; }

    h1, h3 { margin: 10px 0; }
    .reloj { font-size: 2em; font-weight: bold; }
    .resultado, .zona { margin-top: 15px; font-size: 1em; color: #333; }
    body.modo-oscuro .resultado, body.modo-oscuro .zona { color: #ddd; }

    input, button { padding: 10px; margin: 5px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; width: 90%; max-width: 300px; box-sizing: border-box;}
    button { background-color: #3498db; color: white; border: none; cursor: pointer; transition: background-color 0.2s;}
    button:hover { background-color: #2980b9; }

    #modo-toggle { position: fixed; bottom: 10px; right: 10px; font-size: 1.5em; background: none; border: none; cursor: pointer; color: inherit; }

    .seccion { margin: 20px auto; padding: 15px; border-radius: 8px; max-width: 600px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); background-color: rgba(255,255,255,0.9);}
    body.modo-oscuro .seccion { background-color: rgba(50,50,50,0.9); }

    .calendar-container { max-width: 90%; margin: 20px auto; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    .calendar-container iframe { width: 100%; height: 300px; border: none; }

    .firma { margin-top: 15px; font-size: 0.8em; text-align: center; opacity: 0.7; }
    body.modo-claro .firma { color: #666; }
    body.modo-oscuro .firma { color: #aaa; }

    .error { color: red; font-size: 0.9em; margin-top: 5px; }

    @media(max-width:480px) { .reloj { font-size: 1.5em;} input, button { width: 95%; } .calendar-container iframe { height: 250px; } }
    @media(min-width:481px) and (max-width:768px) { input, button { max-width: 90%; } .calendar-container iframe { height: 300px; } }
  </style>
</head>
<body>
<h1><span class="texto-azul">Calculadora de tiempo</span></h1>
<div class="reloj" id="reloj"></div>
<div class="zona" id="zonaHoraria"></div>
<p id="semanaActual"></p>

<div class="seccion">
  <h3><span class="texto-azul">Introduce una fecha</span></h3>
  <input type="date" id="fecha">
  <button onclick="calcularSemana()">Calcular semana</button>
  <button onclick="resetearFormulario()">Resetear</button>
  <div class="resultado" id="resultado"></div>
  <p class="error" id="errorSemana"></p>
</div>

<div class="seccion">
  <h3><span class="texto-azul">Número de días entre dos fechas</span></h3>
  <input type="date" id="fechaInicio" placeholder="Fecha inicio"> a
  <input type="date" id="fechaFin" placeholder="Fecha fin">
  <button onclick="calcularDias()">Calcular días</button>
  <button onclick="resetDias()">Resetear</button>
  <p class="resultado" id="resultadoDias"></p>
  <p class="error" id="errorDias"></p>
</div>

<div class="seccion">
  <h3><span class="texto-azul">Rango de fechas de una semana</span></h3>
  <label for="semanaInput">Semana del año (1-53):</label>
  <input type="number" id="semanaInput" min="1" max="53" placeholder="Número de semana">
  <button onclick="calcularRangoSemana()">Mostrar rango</button>
  <button onclick="resetSemana()">Resetear</button>
  <p class="resultado" id="resultadoSemana"></p>
  <p class="error" id="errorRangoSemana"></p>
</div>

<div class="calendar-container">
  <iframe src="https://calendar.google.com/calendar/embed?src=es.spain%23holiday%40group.v.calendar.google.com&ctz=Europe%2FMadrid&showTitle=0&showTz=0"></iframe>
</div>

<footer class="firma">
  <p>El sitio podría cometer errores, considera contrastar la información.</p>
  <p>Calculadora de tiempo V3.5 por DGCSe7en - Github</p>
</footer>

<button id="modo-toggle" onclick="toggleModo()">☀︎/☾</button>

<script>
let fechaCalendario = new Date();

function formatoFecha(fecha){
  const dia = String(fecha.getDate()).padStart(2,'0');
  const mes = String(fecha.getMonth()+1).padStart(2,'0');
  const año = fecha.getFullYear();
  return `${dia}/${mes}/${año}`;
}

function actualizarReloj(){
  const ahora = new Date();
  const opciones = {hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:'Europe/Madrid'};
  document.getElementById("reloj").innerText = `Hora actual: ${ahora.toLocaleTimeString('es-ES', opciones)}`;
  const esVerano = ahora.getTimezoneOffset() === -120;
  document.getElementById("zonaHoraria").innerText = esVerano ? "Hora local de España (GMT+2)" : "Hora local de España (GMT+1)";
}
setInterval(actualizarReloj,1000);

function toggleModo(){
  const body = document.body;
  if(body.classList.contains('modo-oscuro')){
    body.classList.remove('modo-oscuro'); body.classList.add('modo-claro'); localStorage.setItem('modo','claro');
  } else{
    body.classList.remove('modo-claro'); body.classList.add('modo-oscuro'); localStorage.setItem('modo','oscuro');
  }
}

window.onload = function(){
  const modoGuardado = localStorage.getItem('modo');
  if(modoGuardado==='oscuro') document.body.classList.add('modo-oscuro');
  else document.body.classList.add('modo-claro');
  resetearFormulario();
}

function calcularSemana(){
  const fechaInput = document.getElementById("fecha").value;
  const errorSemana = document.getElementById("errorSemana");
  errorSemana.textContent = '';
  if(!fechaInput){ errorSemana.textContent = "Por favor, introduce una fecha válida."; return;}
  const fecha = new Date(fechaInput);
  const primeraFecha = new Date(fecha.getFullYear(),0,1);
  const dias = Math.floor((fecha-primeraFecha)/(24*60*60*1000));
  const semana = Math.ceil((dias + (primeraFecha.getDay()+6)%7 +1)/7);
  document.getElementById("resultado").innerText = `La fecha ${formatoFecha(fecha)} corresponde a la semana número ${semana} del año.`;
}

function resetearFormulario(){
  document.getElementById("fecha").value = "";
  document.getElementById("errorSemana").textContent = "";
  const hoy = new Date();
  const primeraFecha = new Date(hoy.getFullYear(),0,1);
  const dias = Math.floor((hoy - primeraFecha)/(24*60*60*1000));
  const semanaActual = Math.ceil((dias + (primeraFecha.getDay()+6)%7 +1)/7);
  document.getElementById("semanaActual").innerText = `Hoy es ${formatoFecha(hoy)} y estamos en la semana número ${semanaActual} del año.`;
  document.getElementById("resultado").innerText = "";
  fechaCalendario = new Date();
}

// Función precisa para días -> años, meses, días exactos
function calcularDias(){
  const inicioInput = document.getElementById("fechaInicio").value;
  const finInput = document.getElementById("fechaFin").value;
  const errorDias = document.getElementById("errorDias");
  errorDias.textContent = '';
  if(!inicioInput || !finInput){ errorDias.textContent = "Introduce ambas fechas."; return; }
  let inicio = new Date(inicioInput);
  let fin = new Date(finInput);
  if(fin<inicio){ errorDias.textContent = "La fecha final no puede ser anterior a la inicial."; return; }

  // Cálculo exacto
  let años = fin.getFullYear() - inicio.getFullYear();
  let meses = fin.getMonth() - inicio.getMonth();
  let dias = fin.getDate() - inicio.getDate();

  if(dias<0){ meses--; dias += new Date(fin.getFullYear(), fin.getMonth(), 0).getDate(); }
  if(meses<0){ años--; meses+=12; }

  const diasTotales = Math.round((fin - inicio)/(1000*60*60*24));
  document.getElementById("resultadoDias").textContent = `Hay ${diasTotales} días (${años} años, ${meses} meses, ${dias} días).`;
}

function resetDias(){
  document.getElementById("fechaInicio").value = "";
  document.getElementById("fechaFin").value = "";
  document.getElementById("resultadoDias").textContent = "";
  document.getElementById("errorDias").textContent = "";
}

function calcularRangoSemana(){
  const semana = parseInt(document.getElementById("semanaInput").value);
  const errorRango = document.getElementById("errorRangoSemana");
  errorRango.textContent = '';
  if(isNaN(semana)||semana<1||semana>53){ errorRango.textContent = "Introduce un número de semana válido entre 1 y 53."; return; }
  const año = new Date().getFullYear();
  const primerDia = new Date(año,0,1);
  const diasOffset = (primerDia.getDay()<=4?0:7)-primerDia.getDay();
  const inicioSemana = new Date(año,0,1+diasOffset+(semana-1)*7);
  const finSemana = new Date(inicioSemana);
  finSemana.setDate(inicioSemana.getDate()+6);
  document.getElementById("resultadoSemana").textContent = `Semana ${semana}: del ${formatoFecha(inicioSemana)} al ${formatoFecha(finSemana)}`;
}

function resetSemana(){
  document.getElementById("semanaInput").value="";
  document.getElementById("resultadoSemana").textContent="";
  document.getElementById("errorRangoSemana").textContent="";
}
</script>
</body>
</html>
