<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de tiempo</title>
  <style>
    body {font-family: Arial, sans-serif; margin: 0; padding: 0; transition: background 0.3s, color 0.3s;}
    header {text-align: center; padding: 1rem;}
    .texto-azul {color: #003366; font-weight: bold;}
    body.dark .texto-azul {color: #66aaff;}
    .contenedor {max-width: 800px; margin: auto; padding: 1rem;}
    section {margin-bottom: 2rem;}
    h2 {margin-bottom: 0.5rem;}
    input, button {padding: 0.4rem; margin: 0.2rem 0;}
    .error {color: orange; font-style: italic; font-weight: bold; margin-top: 0.3rem; display:none;}
    .resaltar {border: 2px solid orange; animation: parpadeo 1s 2;}
    @keyframes parpadeo {0%{border-color:orange;}50%{border-color:transparent;}100%{border-color:orange;}}
    footer {text-align: center; font-size: 0.8rem; margin-top: 2rem; padding: 1rem;}
    .modo-toggle {position: fixed; right: 1rem; bottom: 1rem; background: #ddd; border-radius: 50%; width: 50px; height: 50px; border:none; cursor:pointer; font-size:1.4rem; box-shadow:0 2px 6px rgba(0,0,0,0.3);} 
    body.dark {background:#111; color:white;}
    body.dark input, body.dark button {background:#222; color:white; border:1px solid #555;}
    .banderas {text-align: center; margin: 1rem 0;}
    .banderas img {cursor:pointer; margin: 0 5px; width:40px; height:26px; border:1px solid #ccc; border-radius:4px; transition:transform 0.2s;}
    .banderas img:hover {transform:scale(1.1);}
  </style>
</head>
<body>
  <header>
    <h1 class="texto-azul" id="titulo">Calculadora de tiempo</h1>
    <div class="banderas">
      <img src="ESP.png" alt="Español" onclick="cambiarIdioma('es')">
      <img src="CAT.png" alt="Català" onclick="cambiarIdioma('ca')">
      <img src="GAL.png" alt="Galego" onclick="cambiarIdioma('gl')">
      <img src="EUS.png" alt="Euskara" onclick="cambiarIdioma('eu')">
    </div>
    <p id="horaActual" class="texto-azul"></p>
    <p id="horaLocal" class="info"></p>
    <p id="fechaHoy" class="info"></p>
  </header>

  <main class="contenedor">
    <section>
      <h2 class="texto-azul" id="tituloFecha">Introduce una fecha</h2>
      <input type="date" id="fechaInput">
      <button onclick="calcularSemana()" id="btnCalcularSemana">Calcular</button>
      <div id="resultadoSemana"></div>
      <div class="error" id="errorFecha"></div>
    </section>

    <section>
      <h2 class="texto-azul" id="tituloDias">Número de días entre dos fechas</h2>
      <input type="date" id="fechaInicio"> → <input type="date" id="fechaFin">
      <button onclick="calcularDias()" id="btnCalcularDias">Calcular</button>
      <div id="resultadoDias"></div>
      <div class="error" id="errorDias"></div>
    </section>

    <section>
      <h2 class="texto-azul" id="tituloRango">Rango de fechas de una semana</h2>
      <input type="number" id="semanaNumero" min="1" max="53"> → <input type="number" id="anioRango">
      <button onclick="calcularRango()" id="btnCalcularRango">Calcular</button>
      <div id="resultadoRango"></div>
      <div class="error" id="errorRango"></div>
    </section>
  </main>

  <footer>
    <p id="firma">Desarrollado por dgcse7en – Versión 4.0</p>
  </footer>

  <button class="modo-toggle" onclick="toggleModo()">☀︎</button>

  <script async>
    let idioma='es'; let dark=false;
    const textos={
      es:{titulo:"Calculadora de tiempo",horaLocal:"Hora local de España",errorFecha:"⚠️ Introduce una fecha válida",errorDias:"⚠️ Introduce fechas válidas",errorRango:"⚠️ Introduce un rango de fechas válido",btnSemana:"Calcular",btnDias:"Calcular",btnRango:"Calcular",tituloFecha:"Introduce una fecha",tituloDias:"Número de días entre dos fechas",tituloRango:"Rango de fechas de una semana",firma:"Desarrollado por dgcse7en – Versión 4.0"},
      ca:{titulo:"Calculadora de temps",horaLocal:"Hora local d'Espanya",errorFecha:"⚠️ Introdueix una data vàlida",errorDias:"⚠️ Introdueix dates vàlides",errorRango:"⚠️ Introdueix un rang de dates vàlid",btnSemana:"Calcula",btnDias:"Calcula",btnRango:"Calcula",tituloFecha:"Introdueix una data",tituloDias:"Nombre de dies entre dues dates",tituloRango:"Rang de dates d'una setmana",firma:"Desenvolupat per dgcse7en – Versió 4.0"},
      gl:{titulo:"Calculadora de tempo",horaLocal:"Hora local de España",errorFecha:"⚠️ Introduce unha data válida",errorDias:"⚠️ Introduce datas válidas",errorRango:"⚠️ Introduce un rango de datas válido",btnSemana:"Calcular",btnDias:"Calcular",btnRango:"Calcular",tituloFecha:"Introduce unha data",tituloDias:"Número de días entre dúas datas",tituloRango:"Rango de datas dunha semana",firma:"Desenvolvido por dgcse7en – Versión 4.0"},
      eu:{titulo:"Denboraren kalkulagailua",horaLocal:"Espainiako ordu lokala",errorFecha:"⚠️ Baliozko data sartu",errorDias:"⚠️ Baliozko datak sartu",errorRango:"⚠️ Baliozko data tartea sartu",btnSemana:"Kalkulatu",btnDias:"Kalkulatu",btnRango:"Kalkulatu",tituloFecha:"Data bat sartu",tituloDias:"Bi daten arteko egun kopurua",tituloRango:"Aste bateko data tartea",firma:"dgcse7en-ek garatua – 4.0 bertsioa"}
    };

    function cambiarIdioma(l){idioma=l;const t=textos[l];document.getElementById('titulo').textContent=t.titulo;document.getElementById('tituloFecha').textContent=t.tituloFecha;document.getElementById('tituloDias').textContent=t.tituloDias;document.getElementById('tituloRango').textContent=t.tituloRango;document.getElementById('btnCalcularSemana').textContent=t.btnSemana;document.getElementById('btnCalcularDias').textContent=t.btnDias;document.getElementById('btnCalcularRango').textContent=t.btnRango;document.getElementById('firma').textContent=t.firma;actualizarHora();}

    function toggleModo(){dark=!dark;document.body.classList.toggle('dark',dark);document.querySelector('.modo-toggle').textContent=dark?'☾':'☀︎';}

    function mostrarError(idInput,idError,mensaje){const input=document.getElementById(idInput);const error=document.getElementById(idError);error.textContent=mensaje;error.style.display='block';input.classList.add('resaltar');setTimeout(()=>input.classList.remove('resaltar'),2000);}

    function calcularSemana(){const f=document.getElementById('fechaInput').value;if(!f){mostrarError('fechaInput','errorFecha',textos[idioma].errorFecha);return;}const d=new Date(f);const n=obtenerSemana(d);document.getElementById('resultadoSemana').textContent=`${d.toLocaleDateString()} → Semana ${n}`;document.getElementById('errorFecha').style.display='none';}

    function calcularDias(){const fi=document.getElementById('fechaInicio').value;const ff=document.getElementById('fechaFin').value;if(!fi||!ff){mostrarError('fechaInicio','errorDias',textos[idioma].errorDias);return;}const d1=new Date(fi);const d2=new Date(ff);if(d1>d2){mostrarError('fechaInicio','errorDias',textos[idioma].errorDias);return;}const dif=Math.floor((d2-d1)/(1000*60*60*24));const res=desgloseTiempo(dif);document.getElementById('resultadoDias').textContent=`${dif} días (${res})`;document.getElementById('errorDias').style.display='none';}

    function calcularRango(){const s=document.getElementById('semanaNumero').value;const a=document.getElementById('anioRango').value;if(!s||!a){mostrarError('semanaNumero','errorRango',textos[idioma].errorRango);return;}const f1=primerDiaSemana(a,s);const f2=new Date(f1);f2.setDate(f2.getDate()+6);document.getElementById('resultadoRango').textContent=`Semana ${s}: del ${formato(f1)} al ${formato(f2)}`;document.getElementById('errorRango').style.display='none';}

    function obtenerSemana(d){const fecha=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));const diaNum=fecha.getUTCDay()||7;fecha.setUTCDate(fecha.getUTCDate()+4-diaNum);const añoInicio=new Date(Date.UTC(fecha.getUTCFullYear(),0,1));return Math.ceil((((fecha-añoInicio)/86400000)+1)/7);}
    function primerDiaSemana(a,s){const simple=new Date(a,0,1+(s-1)*7);const dow=simple.getDay();const ISOweekStart=simple; if(dow<=4) ISOweekStart.setDate(simple.getDate()-simple.getDay()+1); else ISOweekStart.setDate(simple.getDate()+8-simple.getDay());return ISOweekStart;}
    function formato(f){return ("0"+f.getDate()).slice(-2)+"/"+("0"+(f.getMonth()+1)).slice(-2)+"/"+f.getFullYear();}
    function desgloseTiempo(dias){const años=Math.floor(dias/365);const meses=Math.floor((dias%365)/30);const d=dias-(años*365+meses*30);return `${años} años, ${meses} meses, ${d} días`;}

    function actualizarHora(){const ahora=new Date();document.getElementById('horaActual').textContent="Hora actual: "+ahora.toLocaleTimeString();const offset=(ahora.getTimezoneOffset()===-120)?"GMT +2":"GMT +1";document.getElementById('horaLocal').textContent=textos[idioma].horaLocal+" ("+offset+")";document.getElementById('fechaHoy').textContent="Hoy es "+formato(ahora)+" y estamos en la semana número "+obtenerSemana(ahora)+" del año.";}
    setInterval(actualizarHora,1000);
    window.onload=()=>{cambiarIdioma('es');actualizarHora();};
  </script>
</body>
</html>
